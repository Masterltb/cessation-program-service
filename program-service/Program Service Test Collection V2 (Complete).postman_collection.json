{
	"info": {
		"_postman_id": "a474373f-074f-4209-8ac2-f972222ab49f",
		"name": "Program Service API (v2.2.0)",
		"description": {
			"content": "Đây là bộ sưu tập Postman toàn diện cho `program-service`, được cấu trúc theo tài liệu API chính thức phiên bản 2.2.0.\n\n### Biến môi trường cần thiết:\n- `baseUrl`: URL cơ sở của môi trường (ví dụ: `http://localhost:8080`).\n- `userId`: UUID của người dùng với vai trò `CUSTOMER`.\n- `adminId`: UUID của người dùng với vai trò `ADMIN`.\n- `coachId`: UUID của người dùng với vai trò `COACH`.",
			"type": "text/markdown"
		},
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "1. User-Facing APIs",
			"description": "Các API dành cho người dùng cuối (vai trò CUSTOMER).",
			"item": [
				{
					"name": "Onboarding",
					"item": [
						{
							"name": "POST Submit Baseline Assessment",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status code is 200 OK\", () => pm.response.to.have.status(200));",
											"pm.test(\"Response should contain a recommended template ID\", () => {",
											"    const res = pm.response.json();",
											"    pm.expect(res.recommendedTemplateId).to.be.a('string', 'Recommended template ID is missing.');",
											"    pm.collectionVariables.set(\"recommendedTemplateId\", res.recommendedTemplateId);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "X-User-Id",
										"value": "{{userId}}"
									},
									{
										"key": "X-User-Group",
										"value": "CUSTOMER"
									}
								],
								"body": {
									"mode": "raw",
									"options": {
										"raw": {
											"language": "json"
										}
									},
									"raw": "{\n  \"answers\": [\n    { \"questionId\": \"q1\", \"score\": 4 },\n    { \"questionId\": \"q2\", \"score\": 5 },\n    { \"questionId\": \"q3\", \"score\": 3 },\n    { \"questionId\": \"q4\", \"score\": 2 },\n    { \"questionId\": \"q5\", \"score\": 4 }\n  ]\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/api/onboarding/baseline",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"api",
										"onboarding",
										"baseline"
									]
								},
								"description": "Đánh giá mức độ nghiện ban đầu và gợi ý lộ trình phù hợp.\n\n- **Phân quyền:** `CUSTOMER`"
							},
							"response": []
						}
					]
				},
				{
					"name": "Programs",
					"item": [
						{
							"name": "POST Create Program",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status code is 201 Created\", () => pm.response.to.have.status(201));",
											"pm.test(\"Response should contain a program ID\", () => {",
											"    const res = pm.response.json();",
											"    pm.expect(res.id).to.be.a('string');",
											"    pm.collectionVariables.set(\"programId\", res.id);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "X-User-Id",
										"value": "{{userId}}"
									},
									{
										"key": "X-User-Group",
										"value": "CUSTOMER"
									}
								],
								"body": {
									"mode": "raw",
									"options": {
										"raw": {
											"language": "json"
										}
									},
									"raw": "{\n    \"planDays\": 30\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/v1/programs",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"v1",
										"programs"
									]
								},
								"description": "Tạo một chương trình trả phí mới cho người dùng.\n\n- **Phân quyền:** `CUSTOMER`"
							},
							"response": []
						},
						{
							"name": "GET Active Program",
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "X-User-Id",
										"value": "{{userId}}"
									},
									{
										"key": "X-User-Group",
										"value": "CUSTOMER"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/v1/programs/active",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"v1",
										"programs",
										"active"
									]
								},
								"description": "Lấy chương trình đang hoạt động của người dùng.\n\n- **Phân quyền:** `CUSTOMER`"
							},
							"response": []
						},
						{
							"name": "GET List All Programs",
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "X-User-Id",
										"value": "{{userId}}"
									},
									{
										"key": "X-User-Group",
										"value": "CUSTOMER"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/v1/programs",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"v1",
										"programs"
									]
								},
								"description": "Liệt kê tất cả các chương trình của người dùng.\n\n- **Phân quyền:** `CUSTOMER`"
							},
							"response": []
						}
					]
				},
				{
					"name": "Program Execution",
					"item": [
						{
							"name": "GET Today's Steps",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status code is 200 OK\", () => pm.response.to.have.status(200));",
											"pm.test(\"Save first step ID if available\", () => {",
											"    const res = pm.response.json();",
											"    if (Array.isArray(res) && res.length > 0) {",
											"        pm.collectionVariables.set(\"stepId\", res[0].id);",
											"    }",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "X-User-Id",
										"value": "{{userId}}"
									},
									{
										"key": "X-User-Group",
										"value": "CUSTOMER"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/api/programs/{{programId}}/steps/today",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"api",
										"programs",
										"{{programId}}",
										"steps",
										"today"
									]
								},
								"description": "Lấy danh sách nhiệm vụ của ngày hôm nay (UTC).\n\n- **Phân quyền:** `CUSTOMER`, `COACH`"
							},
							"response": []
						},
						{
							"name": "PATCH Update Step Status",
							"request": {
								"method": "PATCH",
								"header": [
									{
										"key": "X-User-Id",
										"value": "{{userId}}"
									},
									{
										"key": "X-User-Group",
										"value": "CUSTOMER"
									}
								],
								"body": {
									"mode": "raw",
									"options": {
										"raw": {
											"language": "json"
										}
									},
									"raw": "{\n    \"status\": \"COMPLETED\"\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/api/programs/{{programId}}/steps/{{stepId}}/status",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"api",
										"programs",
										"{{programId}}",
										"steps",
										"{{stepId}}",
										"status"
									]
								},
								"description": "Cập nhật trạng thái một nhiệm vụ.\n\n- **Phân quyền:** `CUSTOMER`"
							},
							"response": []
						},
						{
							"name": "POST Create Smoke Event",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "X-User-Id",
										"value": "{{userId}}"
									},
									{
										"key": "X-User-Group",
										"value": "CUSTOMER"
									}
								],
								"body": {
									"mode": "raw",
									"options": {
										"raw": {
											"language": "json"
										}
									},
									"raw": "{\n    \"occurredAt\": \"{{$isoTimestamp}}\",\n    \"kind\": \"SLIP\",\n    \"trigger\": \"STRESS\",\n    \"note\": \"Căng thẳng vì công việc.\"\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/api/programs/{{programId}}/smoke-events",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"api",
										"programs",
										"{{programId}}",
										"smoke-events"
									]
								},
								"description": "Ghi lại một sự kiện hút thuốc. Sự kiện `SLIP` hoặc `RELAPSE` sẽ ngắt chuỗi ngày không hút thuốc (`streak`).\n\n- **Phân quyền:** `CUSTOMER`"
							},
							"response": []
						},
						{
							"name": "GET Current Streak",
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "X-User-Id",
										"value": "{{userId}}"
									},
									{
										"key": "X-User-Group",
										"value": "CUSTOMER"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/api/programs/{{programId}}/streak",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"api",
										"programs",
										"{{programId}}",
										"streak"
									]
								},
								"description": "Lấy thông tin chuỗi ngày không hút thuốc.\n\n- **Phân quyền:** `CUSTOMER`, `COACH`"
							},
							"response": []
						}
					]
				},
				{
					"name": "Quizzes",
					"item": [
						{
							"name": "GET List Due Quizzes",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status code is 200 OK\", () => pm.response.to.have.status(200));",
											"pm.test(\"Save first due quiz template ID if available\", () => {",
											"    const res = pm.response.json();",
											"    if (Array.isArray(res) && res.length > 0) {",
											"        pm.collectionVariables.set(\"dueQuizTemplateId\", res[0].templateId);",
											"    }",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "X-User-Id",
										"value": "{{userId}}"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/v1/me/quizzes",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"v1",
										"me",
										"quizzes"
									]
								},
								"description": "Lấy danh sách các bài quiz đến hạn.\n\n- **Phân quyền:** `CUSTOMER` (Xác thực qua `X-User-Id`)"
							},
							"response": []
						},
						{
							"name": "POST Open Quiz Attempt",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status code is 201 Created\", () => pm.response.to.have.status(201));",
											"pm.test(\"Save attempt ID\", () => {",
											"    const res = pm.response.json();",
											"    pm.collectionVariables.set(\"attemptId\", res.attemptId);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "X-User-Id",
										"value": "{{userId}}"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/v1/me/quizzes/{{dueQuizTemplateId}}/open",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"v1",
										"me",
										"quizzes",
										"{{dueQuizTemplateId}}",
										"open"
									]
								},
								"description": "Bắt đầu một lượt làm bài quiz.\n\n- **Phân quyền:** `CUSTOMER`"
							},
							"response": []
						},
						{
							"name": "POST Submit Quiz Attempt",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "X-User-Id",
										"value": "{{userId}}"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/v1/me/quizzes/{{attemptId}}/submit",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"v1",
										"me",
										"quizzes",
										"{{attemptId}}",
										"submit"
									]
								},
								"description": "Nộp bài và nhận kết quả.\n\n- **Phân quyền:** `CUSTOMER`"
							},
							"response": []
						}
					]
				}
			]
		},
		{
			"name": "2. Admin-Facing APIs",
			"description": "Các API dành cho quản trị viên (vai trò ADMIN).",
			"item": [
				{
					"name": "Program Management",
					"item": [
						{
							"name": "POST Upgrade From Trial",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "X-User-Id",
										"value": "{{adminId}}"
									},
									{
										"key": "X-User-Group",
										"value": "ADMIN"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/api/programs/{{programId}}/upgrade-from-trial",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"api",
										"programs",
										"{{programId}}",
										"upgrade-from-trial"
									]
								},
								"description": "Nâng cấp chương trình từ dùng thử sang trả phí.\n\n- **Phân quyền:** `ADMIN`, `PAYMENT_SERVICE`"
							},
							"response": []
						},
						{
							"name": "PATCH Update Current Day",
							"request": {
								"method": "PATCH",
								"header": [
									{
										"key": "X-User-Id",
										"value": "{{adminId}}"
									},
									{
										"key": "X-User-Group",
										"value": "ADMIN"
									}
								],
								"body": {
									"mode": "raw",
									"options": {
										"raw": {
											"language": "json"
										}
									},
									"raw": "{\n    \"currentDay\": 10\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/api/programs/{{programId}}/current-day",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"api",
										"programs",
										"{{programId}}",
										"current-day"
									]
								},
								"description": "Cập nhật ngày hiện tại của chương trình cho người dùng.\n\n- **Phân quyền:** `ADMIN`"
							},
							"response": []
						}
					]
				},
				{
					"name": "Content & Template Management",
					"item": [
						{
							"name": "GET List Plan Templates",
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "X-User-Id",
										"value": "{{adminId}}"
									},
									{
										"key": "X-User-Group",
										"value": "ADMIN"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/api/plan-templates",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"api",
										"plan-templates"
									]
								},
								"description": "Lấy danh sách tóm tắt các lộ trình mẫu.\n\n- **Phân quyền:** `isAuthenticated()`"
							},
							"response": []
						},
						{
							"name": "POST Create Content Module",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "X-User-Id",
										"value": "{{adminId}}"
									},
									{
										"key": "X-User-Group",
										"value": "ADMIN"
									}
								],
								"body": {
									"mode": "raw",
									"options": {
										"raw": {
											"language": "json"
										}
									},
									"raw": "{\n    \"code\": \"ARTICLE_{{$randomInt}}\",\n    \"type\": \"ARTICLE\",\n    \"lang\": \"vi\",\n    \"version\": \"1.0.0\",\n    \"payload\": {\n        \"title\": \"Bài viết tạo từ Postman\",\n        \"content\": \"Đây là nội dung chi tiết của bài viết.\"\n    }\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/api/modules",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"api",
										"modules"
									]
								},
								"description": "Tạo một module nội dung mới.\n\n- **Phân quyền:** `ADMIN`"
							},
							"response": []
						},
						{
							"name": "POST Create Quiz",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status code is 201 Created\", () => pm.response.to.have.status(201));",
											"pm.test(\"Save quiz template ID\", () => {",
											"    const res = pm.response.json();",
											"    pm.collectionVariables.set(\"quizTemplateId\", res.id);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "X-User-Id",
										"value": "{{adminId}}"
									},
									{
										"key": "X-User-Group",
										"value": "ADMIN"
									}
								],
								"body": {
									"mode": "raw",
									"options": {
										"raw": {
											"language": "json"
										}
									},
									"raw": "{\n    \"name\": \"Weekly Check-in Quiz {{$randomInt}}\",\n    \"languageCode\": \"vi\",\n    \"questions\": [\n        {\n            \"questionNo\": 1,\n            \"text\": \"Trong tuần qua, bạn có cảm thấy căng thẳng không?\",\n            \"type\": \"SINGLE_CHOICE\",\n            \"choices\": [\n                { \"labelCode\": \"A\", \"labelText\": \"Không hề\" },\n                { \"labelCode\": \"B\", \"labelText\": \"Một chút\" },\n                { \"labelCode\": \"C\", \"labelText\": \"Rất nhiều\" }\n            ]\n        }\n    ]\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/v1/admin/quizzes",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"v1",
										"admin",
										"quizzes"
									]
								},
								"description": "Tạo một bộ quiz hoàn chỉnh.\n\n- **Phân quyền:** `ADMIN`"
							},
							"response": []
						},
						{
							"name": "POST Publish Quiz",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "X-User-Id",
										"value": "{{adminId}}"
									},
									{
										"key": "X-User-Group",
										"value": "ADMIN"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/v1/admin/quizzes/{{quizTemplateId}}/publish",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"v1",
										"admin",
										"quizzes",
										"{{quizTemplateId}}",
										"publish"
									]
								},
								"description": "Công khai một quiz template từ `DRAFT` sang `PUBLISHED`.\n\n- **Phân quyền:** `ADMIN`"
							},
							"response": []
						}
					]
				}
			]
		},
		{
			"name": "3. Debug (Dev Profile Only)",
			"item": [
				{
					"name": "GET Who Am I",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-User-Id",
								"value": "{{userId}}"
							},
							{
								"key": "X-User-Group",
								"value": "CUSTOMER"
							},
							{
								"key": "X-User-Tier",
								"value": "PREMIUM"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/debug/whoami",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"debug",
								"whoami"
							]
						},
						"description": "Kiểm tra context xác thực hiện tại. Endpoint này chỉ có sẵn khi ứng dụng chạy với profile `dev`."
					},
					"response": []
				}
			]
		}
	],
	"auth": {
		"type": "noauth"
	},
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:8080",
			"type": "string"
		},
		{
			"key": "userId",
			"value": "a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11",
			"type": "string",
			"description": "UUID for a test user with CUSTOMER role."
		},
		{
			"key": "adminId",
			"value": "a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a12",
			"type": "string",
			"description": "UUID for a test user with ADMIN role."
		},
		{
			"key": "coachId",
			"value": "a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a13",
			"type": "string",
			"description": "UUID for a test user with COACH role."
		},
		{
			"key": "programId",
			"value": "",
			"type": "string"
		},
		{
			"key": "stepId",
			"value": "",
			"type": "string"
		},
		{
			"key": "quizTemplateId",
			"value": "",
			"type": "string"
		},
		{
			"key": "attemptId",
			"value": "",
			"type": "string"
		},
		{
			"key": "dueQuizTemplateId",
			"value": "",
			"type": "string"
		},
		{
			"key": "recommendedTemplateId",
			"value": "",
			"type": "string"
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// This script can be used to add headers to all requests.",
					"// For example, to add a Content-Type header to all POST/PUT/PATCH requests:",
					"const method = pm.request.method.toUpperCase();",
					"if (['POST', 'PUT', 'PATCH'].includes(method)) {",
					"    pm.request.headers.upsert({",
					"        key: 'Content-Type',",
					"        value: 'application/json'",
					"    });",
					"}"
				]
			}
		}
	]
}